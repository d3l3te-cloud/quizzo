const questions = [
  {
    id: 1,
    image: "PYQ/q(1).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "B",
  },
  {
    id: 2,
    image: "PYQ/q(2).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 3,
    image: "PYQ/q(3).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "A",
  },
  {
    id: 4,
    image: "PYQ/q(4).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "A",
  },
  {
    id: 5,
    image: "PYQ/q(5).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 6,
    image: "PYQ/q(6).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "B",
  },
  {
    id: 7,
    image: "PYQ/q(7).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "A",
  },
  {
    id: 8,
    image: "PYQ/q(8).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "D",
  },
  {
    id: 9,
    image: "PYQ/q(9).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "B",
  },
  {
    id: 10,
    image: "PYQ/q(10).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "A",
  },
  {
    id: 11,
    image: "PYQ/q(11).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 12,
    image: "PYQ/q(12).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "D",
  },
  {
    id: 13,
    image: "PYQ/q(13).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "B",
  },
  {
    id: 14,
    image: "PYQ/q(14).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 15,
    image: "PYQ/q(15).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "B",
  },
  {
    id: 16,
    image: "PYQ/q(16).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "D",
  },
  {
    id: 17,
    image: "PYQ/q(17).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "B",
  },
  {
    id: 18,
    image: "PYQ/q(18).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "A",
  },
  {
    id: 19,
    image: "PYQ/q(19).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "A",
  },
  {
    id: 20,
    image: "PYQ/q(20).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 21,
    image: "PYQ/q(21).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "B",
  },
  {
    id: 22,
    image: "PYQ/q(22).png",
    options: [
      { label: "A", text: "Both the assertion and reason are true, and the reason is the correct explanation of the assertion" },
      { label: "B", text: "Both the assertion and reason are true, but the reason is not the correct explanation of the assertion" },
      { label: "C", text: "The assertion is true, but the reason is false" },
      { label: "D", text: "The assertion is false, but the reason is true" },
    ],
    answer: "D",
  },
  {
    id: 23,
    image: "PYQ/q(23).png",
    options: [
      { label: "A", text: "Both the assertion and reason are true, and the reason is the correct explanation of the assertion" },
      { label: "B", text: "Both the assertion and reason are true, but the reason is not the correct explanation of the assertion" },
      { label: "C", text: "The assertion is true, but the reason is false" },
      { label: "D", text: "The assertion is false, but the reason is true" },
    ],
    answer: "C",
  },
  {
    id: 24,
    image: "PYQ/q(24).png",
    options: [
      { label: "A", text: '2−√3 and [1/3,1]' },
      { label: "B", text: "1−√5 and [1/3,1]" },
      { label: "C", text: "2−√10 and [1/3,1]" },
      { label: "D", text: "2−√3 and [1/10,1]" },
    ],
    answer: "A",
  },
  {
    id: 25,
    image: "PYQ/q(25).png",
    options: [
      { label: "A", text: "Select to continue" },
      // { label: "B", text: "Option B" },
      // { label: "C", text: "Option C" },
      // { label: "D", text: "Option D" },
    ],
    answer: "A",
  },
  {
    id: 26,
    image: "PYQ/q(26).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 27,
    image: "PYQ/q(27).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 28,
    image: "PYQ/q(28).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 29,
    image: "PYQ/q(29).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 30,
    image: "PYQ/q(30).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 31,
    image: "PYQ/q(31).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 32,
    image: "PYQ/q(32).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 33,
    image: "PYQ/q(33).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 34,
    image: "PYQ/q(34).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 35,
    image: "PYQ/q(35).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 36,
    image: "PYQ/q(36).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 37,
    image: "PYQ/q(37).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 38,
    image: "PYQ/q(38).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 39,
    image: "PYQ/q(39).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 40,
    image: "PYQ/q(40).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 41,
    image: "PYQ/q(41).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 42,
    image: "PYQ/q(42).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
  {
    id: 43,
    image: "PYQ/q(43).png",
    options: [
      { label: "A", text: "Option A" },
      { label: "B", text: "Option B" },
      { label: "C", text: "Option C" },
      { label: "D", text: "Option D" },
    ],
    answer: "C",
  },
];

let currentIndex = 0;
let selectedAnswer = null;
let userAnswers = new Array(questions.length).fill(null);
let answered = new Array(questions.length).fill(false);
let markedForReview = new Array(questions.length).fill(false);
let perQuestionTime = new Array(questions.length).fill(0);
let timerInterval;
let score = 0;

function startTimer() {
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    perQuestionTime[currentIndex]++;
    updateTimer();
  }, 1000);
}

function updateTimer() {
  const seconds = perQuestionTime[currentIndex];
  const min = String(Math.floor(seconds / 60)).padStart(2, "0");
  const sec = String(seconds % 60).padStart(2, "0");
  document.getElementById("timer").textContent = `⏱ ${min}:${sec}`;
}

function loadQuestion() {
  const q = questions[currentIndex];
  selectedAnswer = userAnswers[currentIndex];

  document.getElementById("questionCount").textContent = `Q${currentIndex + 1}`;
  const imageContainer = document.querySelector(".image-container");
  imageContainer.innerHTML = ""; // Clear previous content

  const imageWrapper = document.createElement("div");
  imageWrapper.className = "image-wrapper";

  const img = document.createElement("img");
  img.src = q.image;
  imageWrapper.appendChild(img);

  const zoomBtn = document.createElement("button");
  zoomBtn.textContent = "🔍";
  zoomBtn.className = "zoom-button";
  zoomBtn.title = "Click to enlarge image";
  zoomBtn.onclick = openModal;

  imageWrapper.appendChild(zoomBtn);
  imageContainer.appendChild(imageWrapper);

  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  document.getElementById("result").textContent = "";

  q.options.forEach((opt) => {
    const btn = document.createElement("button");
    btn.innerHTML = `<strong>${opt.label}</strong>: ${opt.text}`;
    if (selectedAnswer === opt.label) {
      btn.classList.add("selected");
    }
    btn.onclick = () => {
      if (!answered[currentIndex]) {
        selectedAnswer = opt.label;
        userAnswers[currentIndex] = selectedAnswer;
        document
          .querySelectorAll(".options button")
          .forEach((b) => b.classList.remove("selected"));
        btn.classList.add("selected");
      }
    };
    optionsDiv.appendChild(btn);
  });

  updateTimer();
  startTimer();
  updateQuestionGrid();
}

function checkAnswer() {
  if (selectedAnswer === null) {
    alert("Please select an option first.");
    return;
  }

  answered[currentIndex] = true;
  clearInterval(timerInterval);

  const resultDiv = document.getElementById("result");
  const correct = questions[currentIndex].answer;

  if (selectedAnswer === correct) {
    score++;
    resultDiv.textContent = "✅ Correct!";
    resultDiv.className = "result correct-answer";
  } else {
    resultDiv.textContent = `❌ Incorrect! Correct: ${correct}`;
    resultDiv.className = "result wrong-answer";
  }

  updateQuestionGrid();
}

function updateQuestionGrid() {
  const grid = document.getElementById("questionGrid");
  grid.innerHTML = "";

  questions.forEach((q, i) => {
    const btn = document.createElement("button");
    btn.textContent = i + 1;

    if (answered[i]) {
      if (userAnswers[i] === questions[i].answer) {
        btn.classList.add("answered", "flash-green");
      } else {
        btn.classList.add("wrong");
      }
    }

    if (markedForReview[i]) btn.classList.add("marked", "pulse-purple");
    if (i === currentIndex) btn.classList.add("selected");

    btn.onclick = () => {
      currentIndex = i;
      loadQuestion();
    };

    grid.appendChild(btn);
  });
}

function showSubmitPage() {
  clearInterval(timerInterval);
  document.getElementById("quizMain").style.display = "none";
  document.getElementById("submitPage").style.display = "block";
}

function goBackFromSubmit() {
  document.getElementById("submitPage").style.display = "none";
  document.getElementById("quizMain").style.display = "block";
  loadQuestion();
}

function showSummary() {
  // Stop timer
  clearInterval(timerInterval);

  // Switch to summary view
  document.getElementById("submitPage").style.display = "none";
  document.getElementById("summary").style.display = "block";

  // Calculate total quiz time
  const totalSeconds = perQuestionTime.reduce((a, b) => a + b, 0);
  const totalMin = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
  const totalSec = String(totalSeconds % 60).padStart(2, "0");

  // Update timer and final score in UI
  document.getElementById("timer").textContent = `⏱ Total Time: ${totalMin}:${totalSec}`;
  document.getElementById("finalScore").textContent = `✅ You scored ${score} / ${questions.length} | ⏱ Total Time: ${totalMin}:${totalSec}`;

  // Build summary content
  const summaryDiv = document.getElementById("summaryContent");
  summaryDiv.innerHTML = "";

  questions.forEach((q, idx) => {
    const time = perQuestionTime[idx];
    const min = String(Math.floor(time / 60)).padStart(2, "0");
    const sec = String(time % 60).padStart(2, "0");
    const userAns = userAnswers[idx] || "Not Answered";
    const isCorrect = userAnswers[idx] === q.answer;

    const div = document.createElement("div");
    div.innerHTML = `
      <h3>Q${idx + 1} ⏱ (${min}:${sec})</h3>
      <img src="${q.image}" alt="Q${idx + 1}" style="max-width:100%;border:1px solid #aaa; border-radius:5px;">
      <p><strong>Your Answer:</strong> 
        <span class="${isCorrect ? "correct-text" : "wrong-text"}">${userAns}</span>
      </p>
      <p><strong>Correct Answer:</strong> 
        <span class="correct-text">${q.answer}</span>
      </p>
      <hr/>
    `;
    summaryDiv.appendChild(div);
  });

  // --- Save result to Firestore ---
  if (window.saveQuizResult) {
    window.saveQuizResult({
      score: score,
      totalQuestions: questions.length,
      totalSeconds: totalSeconds
    })
    .then(id => {
      console.log("Result saved to Firestore, ID:", id);
    })
    .catch(err => {
      console.error("Error saving result:", err);
    });
  } else {
    console.warn("saveQuizResult not found — make sure quiz-firebase.js is loaded before ab.js");
  }
}


function retryQuiz() {
  location.reload();
}

document.getElementById("nextBtn").onclick = () => {
  if (currentIndex < questions.length - 1) {
    currentIndex++;
    loadQuestion();
  } else {
    showSubmitPage();
  }
};

document.getElementById("prevBtn").onclick = () => {
  if (currentIndex > 0) {
    currentIndex--;
    loadQuestion();
  }
};

document.getElementById("checkBtn").onclick = checkAnswer;
document.getElementById("markReviewBtn").onclick = () => {
  markedForReview[currentIndex] = !markedForReview[currentIndex];
  const btn = document.getElementById("markReviewBtn");

  btn.classList.add("pulse-purple");
  setTimeout(() => btn.classList.remove("pulse-purple"), 1000);

  updateQuestionGrid();
};

document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("clearBtn").addEventListener("click", () => {
    // Don't allow clearing after checking
    if (answered[currentIndex]) return;

    selectedAnswer = null;
    userAnswers[currentIndex] = null;

    const optionButtons = document.querySelectorAll(".options button");
    optionButtons.forEach((b) => b.classList.remove("selected"));

    document.getElementById("result").textContent = "";
    updateQuestionGrid();
  });
});

function openModal() {
  const modal = document.getElementById("imageModal");
  const enlargedImg = document.getElementById("enlargedImg");
  const q = questions[currentIndex];
  enlargedImg.src = q.image;
  modal.style.display = "block";
}

function closeModal() {
  document.getElementById("imageModal").style.display = "none";
}



let isZoomed = false;

document.getElementById("enlargedImg").addEventListener("click", function () {
  if (!isZoomed) {
    this.style.transform = "scale(1.8)";
    this.style.cursor = "zoom-out";
    isZoomed = true;
  } else {
    this.style.transform = "scale(1)";
    this.style.cursor = "zoom-in";
    isZoomed = false;
  }
});



document.addEventListener("DOMContentLoaded", () => {
  loadQuestion();
});


